<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Temujanji MR SIA – PKD Kuala Terengganu</title>
  <style>
    body{margin:0;font-family:system-ui,Arial;background:#0f172a;color:#e5e7eb}
    .wrap{max-width:640px;margin:0 auto;padding:20px}
    h1{font-size:20px;margin:0 0 10px}
    .card{background:#0b1220;border:1px solid #334155;border-radius:12px;padding:14px}
    label{display:block;margin:10px 0 4px;color:#94a3b8}
    input,select,button{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#0a1020;color:#e5e7eb}
    button{cursor:pointer;font-weight:600}
    .btn{background:#38bdf8;color:#06213a;border:none;margin-top:12px}
    .row{margin-top:8px}
    footer{margin:16px 0;text-align:center;color:#94a3b8}
    .help{font-size:12px;color:#94a3b8}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Temujanji Kempen MR SIA – PKD Kuala Terengganu</h1>
    <p class="help">Syarat umur: Kanak-kanak 6–59 bulan (tarikh lahir antara 1/8/2020 hingga 31/1/2025).</p>

    <form id="form" class="card">
      <label for="nama">Nama penuh</label>
      <input id="nama" required placeholder="Contoh: Ahmad bin Ali"/>

      <label for="telefon">No. telefon</label>
      <input id="telefon" required placeholder="Contoh: 0123456789"/>

      <label for="bertugas">Tempat bertugas</label>
      <input id="bertugas" required placeholder="Contoh: PKD Kuala Terengganu"/>

      <label for="bil">Bilangan anak (6–59 bulan)</label>
      <select id="bil" required>
        <option value="" disabled selected>Pilih bilangan</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select>

      <div id="anakFields" class="row"></div>

      <label for="hari">Pilihan hari</label>
      <select id="hari" required>
        <option value="bekerja" selected>Hari bekerja (Ahad–Khamis)</option>
        <option value="cuti">Hari cuti minggu (Jumaat–Sabtu)</option>
      </select>

      <label for="tarikh">Tarikh pilihan</label>
      <input type="date" id="tarikh" required />

      <label for="lokasi">Tempat suntikan</label>
      <select id="lokasi" required></select>

      <label for="masa">Slot masa</label>
      <select id="masa" required></select>

      <button class="btn" type="submit">Hantar</button>
    </form>

    <footer>
      Dibangunkan oleh <strong>ChatGPT (Codex & GitHub)</strong>, Powered By <strong>Staf PKD Kuala Terengganu</strong>
    </footer>
  </div>

  <script>
    // === Konfigurasi ringkas ===
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxb_M-y8UXguhPu4XV_0OL2zjn-KTDNyVALh_rCBEWTPBdsZLjjdLxhGSe-tc_uGlmG/exec"; // URL Apps Script
    const LOKASI_BEKERJA = ['KK Hiliran','KK Manir','KK Chendering','KK UTC','KK Paya Datu'];
    const LOKASI_CUTI = ['KK Hiliran'];

    // === Elemen ===
    const form = document.getElementById('form');
    const bil = document.getElementById('bil');
    const anakFields = document.getElementById('anakFields');
    const hari = document.getElementById('hari');
    const lokasi = document.getElementById('lokasi');
    const masa = document.getElementById('masa');

    // === Util ===
    function setOptions(select, arr){
      select.innerHTML = '';
      const ph = document.createElement('option'); ph.value=''; ph.textContent='-- pilih --'; ph.disabled=true; ph.selected=true;
      select.appendChild(ph);
      arr.forEach(v=>{ const o=document.createElement('option'); o.textContent=o.value=v; select.appendChild(o); });
    }

    function updateLokasiMasa(){
      if(hari.value === 'bekerja'){
        setOptions(lokasi, LOKASI_BEKERJA);
        setOptions(masa, ['9:00–1:00','2:00–4:00']);
      }else{
        setOptions(lokasi, LOKASI_CUTI);
        setOptions(masa, ['9:00–1:00']);
      }
    }

    // === Dinamik umur anak ===
    bil.addEventListener('change', ()=>{
      anakFields.innerHTML='';
      const n = parseInt(bil.value||'0',10);
      for(let i=1;i<=n;i++){
        const wrap = document.createElement('div');
        wrap.className='row';
        wrap.innerHTML = `
          <label for="umur${i}">Umur Anak ${i} (bulan)</label>
          <input type="number" id="umur${i}" min="6" max="59" required />`;
        anakFields.appendChild(wrap);
      }
    });

    // === Tukar hari -> isi lokasi & masa ===
    hari.addEventListener('change', updateLokasiMasa);

    // === Init pada load ===
    window.addEventListener('DOMContentLoaded', ()=>{
      updateLokasiMasa();
    });

    // === Submit ===
    form.addEventListener('submit', (e)=>{
      e.preventDefault();

      const n = parseInt(bil.value||'0',10);
      const umur = Array.from({length:n}, (_,i)=> parseInt(document.getElementById('umur'+(i+1)).value||'0',10));
      if(!n || umur.some(u=>!u || u<6 || u>59)){
        alert('Sila masukkan umur anak 6–59 bulan.');
        return;
      }

      const data = {
        timestamp: new Date().toISOString(),
        nama: document.getElementById('nama').value.trim(),
        telefon: document.getElementById('telefon').value.trim(),
        bertugas: document.getElementById('bertugas').value.trim(),
        bilAnak: n,
        umur: umur,
        pilihanHari: (hari.value === 'bekerja') ? 'Hari bekerja (Ahad–Khamis)' : 'Hari cuti minggu (Jumaat–Sabtu)',
        tarikh: document.getElementById('tarikh').value,
        masa: masa.value,
        lokasi: lokasi.value
      };

      // Hantar ke Google Sheet (Apps Script)
      fetch(WEB_APP_URL, {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data)
      })
      .then(r=>r.text())
      .then(()=>{ alert('Berjaya dihantar ke Google Sheet.'); form.reset(); anakFields.innerHTML=''; updateLokasiMasa(); })
      .catch(err=>{ console.error(err); alert('Gagal hantar. Semak tetapan Web App & cuba lagi.'); });
    });
  </script>
</body>
</html>
