<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>Temujanji Kempen MR SIA – PKD Kuala Terengganu</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    body{margin:0;font-family:system-ui,Arial;background:#0f172a;color:#e5e7eb}
    .container{max-width:900px;margin:0 auto;padding:24px}
    h1{font-size:20px;margin-bottom:12px}
    .card{background:#0b1220;border:1px solid #334155;border-radius:12px;padding:18px;margin:12px 0}
    label{display:block;margin-bottom:4px;font-size:14px;color:#94a3b8}
    input,select,button,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#0a1020;color:#e5e7eb;font-size:14px}
    button{cursor:pointer;font-weight:600}
    .btn-primary{background:#38bdf8;color:#06213a;border:none}
    .actions{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .help{font-size:12px;color:#94a3b8}
    footer{text-align:center;margin:18px 0;color:#94a3b8}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid #334155;padding:8px 12px;border-radius:999px;cursor:pointer;user-select:none}
    input[type=radio].sr-only{position:absolute;opacity:0;pointer-events:none}
    input[type=radio]:checked+label.chip{background:#38bdf8;color:#06213a;border-color:#38bdf8;font-weight:700}
    .notice{padding:10px;border-radius:10px;border:1px solid #334155;background:#0b1326;margin-top:10px}
    .hidden{display:none!important}
  </style>
</head>
<body>
  <div class="container">
    <h1>Temujanji Kempen MR SIA – PKD Kuala Terengganu</h1>
    <p><strong>Syarat umur:</strong> Kanak-kanak 6–59 bulan (tarikh lahir antara 1/8/2020 hingga 31/1/2025).</p>

    <form id="apptForm" class="card">
      <label for="nama">Nama penuh</label>
      <input id="nama" name="nama" required />

      <label for="telefon">No. telefon</label>
      <input id="telefon" name="telefon" required />

      <label for="bertugas">Tempat bertugas</label>
      <input id="bertugas" name="bertugas" required />

      <label for="bilAnak">Bilangan anak (6–59 bulan)</label>
      <select id="bilAnak" name="bilAnak" required>
        <option value="" disabled selected>Pilih bilangan</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select>

      <div id="anakFields"></div>

      <label>Pilihan hari</label>
      <div id="hariGroup" class="chips"></div>

      <label for="tarikh">Tarikh pilihan</label>
      <input type="date" id="tarikh" name="tarikh" required />

      <label>Tempat suntikan</label>
      <div id="lokasiGroup" class="chips"></div>
      <div class="help" id="lokasiHelp"></div>

      <label>Slot masa</label>
      <div id="masaGroup" class="chips"></div>

      <div id="msg" class="notice hidden"></div>

      <div class="actions">
        <button type="submit" class="btn-primary">Hantar</button>
        <button type="reset" id="resetBtn">Reset</button>
      </div>
    </form>

    <footer>
      Dibangunkan oleh <strong>ChatGPT (Codex &amp; GitHub)</strong>, Powered By <strong>Staf PKD Kuala Terengganu</strong>
    </footer>
  </div>

  <script>
    // ====== Elemen ======
    const form = document.getElementById('apptForm');
    const bilAnak = document.getElementById('bilAnak');
    const anakFields = document.getElementById('anakFields');
    const tarikh = document.getElementById('tarikh');
    const lokasiGroup = document.getElementById('lokasiGroup');
    const hariGroup = document.getElementById('hariGroup');
    const masaGroup = document.getElementById('masaGroup');
    const lokasiHelp = document.getElementById('lokasiHelp');
    const msg = document.getElementById('msg');
    const resetBtn = document.getElementById('resetBtn');

    // ====== Konfigurasi ======
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxb_M-y8UXguhPu4XV_0OL2zjn-KTDNyVALh_rCBEWTPBdsZLjjdLxhGSe-tc_uGlmG/exec"; // tukar jika perlu
    const LOKASI_HARI_BEKERJA = ['KK Hiliran','KK Manir','KK Chendering','KK UTC','KK Paya Datu'];
    const LOKASI_HUJUNG_MINGGU = ['KK Hiliran'];

    // ====== Utiliti ======
    function renderRadios(name, container, options){
      container.innerHTML = '';
      options.forEach((opt,i)=>{
        const id = `${name}_${opt.replace(/[^a-zA-Z0-9]+/g,'_')}`;
        const input = document.createElement('input');
        input.type = 'radio'; input.className = 'sr-only'; input.name = name; input.id = id; input.value = opt;
        if(i===0) input.required = true;
        const label = document.createElement('label');
        label.className = 'chip'; label.setAttribute('for', id); label.textContent = opt;
        const wrap = document.createElement('div'); wrap.appendChild(input); wrap.appendChild(label);
        container.appendChild(wrap);
      });
    }
    function showMsg(type, text){
      msg.classList.remove('hidden');
      msg.style.borderColor = (type==='error'? '#ef4444' : type==='warn' ? '#f59e0b' : '#334155');
      msg.textContent = text;
    }
    function clearMsg(){ msg.classList.add('hidden'); msg.textContent=''; }

    // ====== Dinamik bilangan anak ======
    bilAnak.addEventListener('change', ()=>{
      anakFields.innerHTML = '';
      const count = parseInt(bilAnak.value||'0');
      for(let i=1;i<=count;i++){
        const div = document.createElement('div');
        div.innerHTML = `
          <label for="umur${i}">Umur Anak ${i} (bulan)</label>
          <input type="number" id="umur${i}" name="umur${i}" min="6" max="59" required />
          <div class="help" id="umur${i}Help"></div>
        `;
        anakFields.appendChild(div);
      }
    });iv>
        `;
        anakFields.appendChild(div);
      }
   hariGroup.addEventListener('change', (e)=>{
      if(e.target && e.target.name === 'hari'){ setLokasiAndMasaByDay(); }
    });

    // Validasi umur anak (6–59 bulan)
    anakFields.addEventListener('input', (e)=>{
      if(e.target && /^umur\\d+$/.test(e.target.id)){
        const i = e.target.id.replace('umur','');
        const help = document.getElementById(`umur${i}Help`);
        const val = parseInt(e.target.value||'0',10);
        if(!val){ help.textContent=''; return; }
        if(val < 6 || val > 59){ help.textContent = 'Umur mesti antara 6–59 bulan'; }
        else { help.textContent = 'OK'; }
      }
    }); if(e.target && e.target.name === 'hari'){ setLokasiAndMasaByDay(); }
    });

    // Validasi umur anak (6–59 bulan)
    anakFields.addEventListener('input', (e)=>{
      if(e.target && /^umur\d+$/.test(e.target.id)){
        const i = e.target.id.replace('umur','');
        const help = document.getElementById(`umur${i}Help`);
        const val = parseInt(e.target.value||'0',10);
        if(!val){ help.textContent=''; return; }
        if(val < 6 || val > 59){ help.textContent = 'Umur mesti antara 6–59 bulan'; }
        else { help.textContent = 'OK'; }
      }
    }); }
    });
    function setLokasiAndMasaByDay(){
      lokasiGroup.innerHTML = '';
      masaGroup.innerHTML = '';
      lokasiHelp.textContent = '';
      const hariPick = document.querySelector('input[name="hari"]:checked');
      const isBekerja = !hariPick || /bekerja/i.test(hariPick.value);
      const locs = isBekerja ? LOKASI_HARI_BEKERJA : LOKASI_HUJUNG_MINGGU;
      renderRadios('lokasi', lokasiGroup, locs);
      if(isBekerja){
        lokasiHelp.textContent = 'Hari bekerja (Ahad–Khamis): KK Hiliran, KK Manir, KK Chendering, KK UTC, KK Paya Datu';
        renderRadios('masa', masaGroup, ['9const umur = Array.from({length:n},(_,i)=> parseInt(document.getElementById('umur'+(i+1)).value||'0',10));
      if(umur.some(m => !m || m < 6 || m > 59)){
        showMsg('error','Masukkan umur anak antara 6–59 bulan.');
        return;
      }Jumaat–Sabtu): KK Hiliran sahaja';
        renderRadios('masa', masaGroup, ['9:00–1:00']);
      }
    }

    // ====== Submit ======
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      clearMsg();
      const nama = document.getElementById('nama').value.trim();
      const telefon = document.getElementById('telefon').value.trim();
      const bertugas = document.getElementById('bertugas').value.trim();
      const n = parseInt(bilAnak.value||'0',10);
      const umur = Array.from({length:n},(_,i)=> parseInt(document.getElementById('umur'+(i+1)).value||'0',10));
      if(umur.some(m => !m || m < 6 || m > 59)){
        showMsg('error','Masukkan umur anak antara
      const hariPick = document.querySelector('inpbilAnak: n, umur, dob: umur.map(m=> `${m} bulan`),checked');
      const isBekerja = !hariPick || /bekerja/i.test(hariPick.value);
      const tarikhVal = tarikh.value;
      const locPick = document.querySelector('input[name="lokasi"]:checked');
      const masaPick = document.querySelector('input[name="masa"]:checked');
      const lokasiVal = locPick ? locPick.value : '';
      const masaVal = masaPick ? masaPick.value : '';

      if(!nama || !telefon || !bertugas || !n || !tarikhVal || !lokasiVal || !masaVal){
        showMsg('error','Sila lengkapkan semua maklumat dan pilihan.');
        return;
      }

      const data = {
        timestamp: new Date().toISOString(),
        nama, telefon, bertugas,
        bilAnak: n, dob,
        pilihanHari: i bekerja (Ahad–Khamis)' : 'Hari cuti minggu (Jumaat–Sabtu)',
        tarikh: tarikhVal,
        masa: masaVal,
        lokasi: lokasiVal
      };

      // Hantar ke Google Apps Script (Sheet)
      fetch(WEB_APP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(r => r.text())
      .then(txt => {
        showMsg('info','Berjaya dihantar ke Google Sheet.');
        console.log('Respon:', txt);
        form.reset();
        anakFields.innerHTML=''; lokasiGroup.innerHTML=''; masaGroup.innerHTML='';
        renderRadios('hari', hariGroup, ['Hari bekerja (Ahad–Khamis)','Hari cuti minggu (Jumaat–Sabtu)']);
        setLokasiAndMasaByDay();
      })
      .catch(err => {
        console.error(err);
        showMsg('warn','Gagal hantar ke Google Sheet. Semak akses deployment (Anyone with link).');
      });
    });

    // ====== Reset ======
    resetBtn.addEventListener('click', ()=>{
      clearMsg(); anakFields.innerHTML=''; lokasiGroup.innerHTML=''; masaGroup.innerHTML='';
      renderRadios('hari', hariGroup, ['Hari bekerja (Ahad–Khamis)','Hari cuti minggu (Jumaat–Sabtu)']);
      setLokasiAndMasaByDay();
    });

    // ====== Init ======
    renderRadios('hari', hariGroup, ['Hari bekerja (Ahad–Khamis)','Hari cuti minggu (Jumaat–Sabtu)']);
    setLokasiAndMasaByDay();
  </script>
</body>
</html>
